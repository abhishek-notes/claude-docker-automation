<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Claude Task Launcher</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				padding: 20px;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				background: white;
				border-radius: 15px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
				overflow: hidden;
			}

			.header {
				background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
				color: white;
				padding: 30px;
				text-align: center;
			}

			.header h1 {
				font-size: 2.5em;
				margin-bottom: 10px;
			}

			.header p {
				font-size: 1.2em;
				opacity: 0.9;
			}

			.main-content {
				padding: 40px;
			}

			.section {
				margin-bottom: 30px;
				padding: 25px;
				border: 2px solid #e1e8ed;
				border-radius: 10px;
				background: #f8f9fa;
			}

			.section h2 {
				color: #2a5298;
				margin-bottom: 15px;
				font-size: 1.5em;
			}

			.form-group {
				margin-bottom: 20px;
			}

			label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
				color: #333;
			}

			input,
			textarea,
			select {
				width: 100%;
				padding: 12px;
				border: 2px solid #ddd;
				border-radius: 8px;
				font-size: 16px;
				transition: border-color 0.3s;
			}

			input:focus,
			textarea:focus,
			select:focus {
				outline: none;
				border-color: #2a5298;
			}

			textarea {
				min-height: 150px;
				resize: vertical;
				font-family: "Courier New", monospace;
			}

			.btn {
				padding: 12px 30px;
				background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
				color: white;
				border: none;
				border-radius: 8px;
				font-size: 16px;
				font-weight: 600;
				cursor: pointer;
				transition: transform 0.2s, box-shadow 0.2s;
				margin-right: 10px;
				margin-bottom: 10px;
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 5px 15px rgba(42, 82, 152, 0.3);
			}

			.btn:active {
				transform: translateY(0);
			}

			.btn-secondary {
				background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
			}

			.btn-success {
				background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
			}

			.btn-danger {
				background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
			}

			.improved-task {
				background: #e8f5e8;
				border: 2px solid #28a745;
				padding: 20px;
				border-radius: 8px;
				margin-top: 15px;
			}

			.improved-task h3 {
				color: #28a745;
				margin-bottom: 10px;
			}

			.improved-task pre {
				background: white;
				padding: 15px;
				border-radius: 5px;
				border-left: 4px solid #28a745;
				overflow-x: auto;
				white-space: pre-wrap;
				font-family: "Courier New", monospace;
			}

			.status-panel {
				background: #f8f9fa;
				border: 2px solid #6c757d;
				border-radius: 8px;
				padding: 20px;
				margin-top: 20px;
			}

			.status-running {
				border-color: #ffc107;
				background: #fff3cd;
			}

			.status-success {
				border-color: #28a745;
				background: #d4edda;
			}

			.status-error {
				border-color: #dc3545;
				background: #f8d7da;
			}

			.log-output {
				background: #000;
				color: #00ff00;
				padding: 15px;
				border-radius: 5px;
				font-family: "Courier New", monospace;
				max-height: 400px;
				overflow-y: auto;
				margin-top: 10px;
			}

			.grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 20px;
			}

			@media (max-width: 768px) {
				.grid {
					grid-template-columns: 1fr;
				}

				.header h1 {
					font-size: 2em;
				}

				.main-content {
					padding: 20px;
				}
			}

			.example-tasks {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				margin-top: 10px;
			}

			.example-task {
				background: #e9ecef;
				padding: 8px 15px;
				border-radius: 20px;
				cursor: pointer;
				font-size: 14px;
				transition: background 0.2s;
			}

			.example-task:hover {
				background: #2a5298;
				color: white;
			}

			.hidden {
				display: none;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>ü§ñ Claude Task Launcher</h1>
				<p>Create, improve, and launch automated Claude tasks</p>
			</div>

			<div class="main-content">
				<!-- Task Creation Section -->
				<div class="section">
					<h2>üìù Create Your Task</h2>

					<div class="form-group">
						<label for="projectPath">Project Path:</label>
						<input
							type="text"
							id="projectPath"
							placeholder="/Users/abhishek/Work/my-project"
							value="/Users/abhishek/Work/"
							onchange="updateProfileSuggestion()"
						/>
					</div>

					<div class="form-group">
						<label for="taskType">Task Type:</label>
						<select id="taskType" onchange="updateTaskTemplate()">
							<option value="custom">Custom Task</option>
							<option value="webapp">Web Application</option>
							<option value="api">REST API</option>
							<option value="frontend">Frontend Component</option>
							<option value="refactor">Code Refactoring</option>
							<option value="testing">Add Tests</option>
							<option value="documentation">Documentation</option>
							<option value="bugfix">Bug Fix</option>
						</select>
					</div>

					<div class="form-group">
						<label for="itermProfile">Session Type:</label>
						<select id="itermProfile">
							<option value="Default">‚ö™ Default</option>
							<option value="Palladio">üü™ Palladio</option>
							<option value="Work">üîµ Work</option>
							<option value="Automation">üü¢ Automation</option>
						</select>
						<small style="color: #666"
							>Choose session type for visual identification (tmux)</small
						>
					</div>

					<div class="form-group" style="margin-top: 15px;">
						<label style="display: flex; align-items: center; cursor: pointer; max-width: fit-content;">
							<input type="checkbox" id="useDocker" checked style="margin-right: 8px; width: 16px; height: 16px; accent-color: #2a5298;">
							<span style="font-weight: 500;">üê≥ Use Persistent Docker Container</span>
						</label>
						<small style="color: #666; margin-left: 24px; display: block; margin-top: 4px; font-size: 13px;">
							Creates a persistent container with colorful icon (won't auto-start on Docker restart)
						</small>
					</div>

					<div class="form-group" style="margin-top: 15px;">
						<label style="display: flex; align-items: center; cursor: pointer; max-width: fit-content;">
							<input type="checkbox" id="openInNewTab" checked style="margin-right: 8px; width: 16px; height: 16px; accent-color: #2a5298;">
							<span style="font-weight: 500;">üìë Open in New Tab</span>
						</label>
						<small style="color: #666; margin-left: 24px; display: block; margin-top: 4px; font-size: 13px;">
							Opens Claude in a new iTerm tab (unchecked: uses existing tab)
						</small>
					</div>

					<div class="form-group">
						<label for="taskDescription"
							>Describe what you want Claude to build:</label
						>
						<textarea
							id="taskDescription"
							placeholder="I want to create a coin flip app with a nice UI that shows heads/tails animation..."
						></textarea>
					</div>

					<div class="example-tasks">
						<div class="example-task" onclick="setExampleTask('webapp')">
							Web App Example
						</div>
						<div class="example-task" onclick="setExampleTask('api')">
							API Example
						</div>
						<div class="example-task" onclick="setExampleTask('component')">
							Component Example
						</div>
						<div class="example-task" onclick="setExampleTask('bugfix')">
							Bug Fix Example
						</div>
					</div>

					<div style="margin-top: 20px">
						<button class="btn" onclick="improveTask()">
							‚ú® Improve Task Instructions
						</button>
						<button class="btn btn-secondary" onclick="clearTask()">
							üóëÔ∏è Clear
						</button>
					</div>
				</div>

				<!-- Improved Task Display -->
				<div class="section hidden" id="improvedTaskSection">
					<h2>üéØ Improved Task Instructions</h2>
					<div class="improved-task">
						<h3>Enhanced Task for Claude:</h3>
						<pre id="improvedTaskContent"></pre>
					</div>

					<div style="margin-top: 20px">
						<button class="btn btn-success" onclick="launchAutomatedTask()">
							üöÄ Launch Automated Task
						</button>
						<button class="btn btn-secondary" onclick="downloadTaskFile()">
							üíæ Download Task File
						</button>
						<button class="btn btn-secondary" onclick="editImprovedTask()">
							‚úèÔ∏è Edit
						</button>
					</div>
				</div>

				<!-- Execution Status -->
				<div class="section hidden" id="executionSection">
					<h2>‚ö° Task Execution</h2>
					<div class="status-panel" id="statusPanel">
						<h3 id="statusTitle">üöÄ Starting Automated Task...</h3>
						<p id="statusMessage">Initializing Claude automation...</p>
						<div class="log-output" id="logOutput"></div>
					</div>

					<div style="margin-top: 20px">
						<button
							class="btn btn-danger hidden"
							id="stopButton"
							onclick="stopExecution()"
						>
							üõë Stop Execution
						</button>
						<button class="btn" onclick="viewResults()">üìä View Results</button>
						<button class="btn btn-secondary" onclick="createNewTask()">
							üîÑ New Task
						</button>
					</div>
				</div>
			</div>
		</div>

		<script>
			let currentTask = ""
			let executionProcess = null
			let currentSessionId = null

			// Task templates
			const taskTemplates = {
				webapp: `Create a complete web application with:
- Modern HTML/CSS/JavaScript
- Responsive design
- Interactive features
- Clean code structure
- README with setup instructions`,

				api: `Build a REST API with:
- Express.js or similar framework
- CRUD operations
- Input validation
- Error handling
- API documentation
- Tests`,

				frontend: `Create a frontend component with:
- Modern framework (React/Vue/Vanilla JS)
- Responsive design
- Interactive functionality
- Clean CSS styling
- Reusable code structure`,

				refactor: `Refactor the existing code to:
- Improve code structure
- Add proper error handling
- Optimize performance
- Add documentation
- Maintain functionality
- Add tests if missing`,

				testing: `Add comprehensive tests:
- Unit tests for core functions
- Integration tests
- Test coverage >80%
- Mock external dependencies
- CI/CD integration
- Test documentation`,

				documentation: `Create comprehensive documentation:
- README with setup instructions
- API documentation
- Code comments
- Usage examples
- Troubleshooting guide
- Architecture overview`,

				bugfix: `Fix the reported bug:
- Identify root cause
- Implement proper fix
- Add tests to prevent regression
- Update documentation
- Verify fix works
- Clean up related code`,
			}

			// Example tasks
			const exampleTasks = {
				webapp:
					"Create a coin flip app with animation, heads/tails tracking, and a reset button",
				api: "Build a todo list API with CRUD operations, user authentication, and data persistence",
				component:
					"Create a reusable date picker component with custom styling and validation",
				bugfix:
					"Fix the memory leak in the image carousel component that occurs after 10+ slides",
			}

			function updateTaskTemplate() {
				const taskType = document.getElementById("taskType").value
				if (taskType !== "custom" && taskTemplates[taskType]) {
					const current = document.getElementById("taskDescription").value
					if (!current.trim()) {
						document.getElementById("taskDescription").value =
							taskTemplates[taskType]
					}
				}
			}

			function setExampleTask(type) {
				document.getElementById("taskDescription").value =
					exampleTasks[type] || ""
			}

			function clearTask() {
				document.getElementById("taskDescription").value = ""
				document.getElementById("improvedTaskSection").classList.add("hidden")
			}

			function improveTask() {
				const description = document
					.getElementById("taskDescription")
					.value.trim()
				const projectPath = document.getElementById("projectPath").value.trim()
				const taskType = document.getElementById("taskType").value

				if (!description) {
					alert("Please enter a task description")
					return
				}

				if (!projectPath) {
					alert("Please enter a project path")
					return
				}

				// Simulate task improvement (in real implementation, this would call an AI service)
				const improvedTask = generateImprovedTask(
					description,
					taskType,
					projectPath
				)

				document.getElementById("improvedTaskContent").textContent =
					improvedTask
				document
					.getElementById("improvedTaskSection")
					.classList.remove("hidden")

				currentTask = improvedTask
			}

			function generateImprovedTask(description, type, projectPath) {
				const projectName = projectPath.split("/").pop()
				const timestamp = new Date().toISOString().slice(0, 19)
				const sessionId = "session-" + Date.now()

				return `# Claude Autonomous Task - ${projectName}

## üéØ PROJECT GOAL
${description}

## Project Overview
- **Goal**: ${description}
- **Type**: ${type}
- **Project Path**: ${projectPath}
- **Created**: ${timestamp}

## Project Context
- Repository: ${projectName}
- Project Path: ${projectPath}
- Session ID: ${sessionId}
- Branch Strategy: Always create feature branches from main, never commit directly to main
- GitHub Config: /Users/abhishek/Work/config/.env.github (GitHub classic token)
- Safety: Backup files before modification, track all changes

## üìã METHODOLOGY - DOCUMENTATION FIRST APPROACH

### Phase 1: Documentation Discovery (READ FIRST, CODE LATER)
1. **Workspace Navigation**: Read /workspace/documentation/PROJECT_INDEX.md for workspace overview
2. **Project Type Recognition**:
   - **Palladio Software**: Read START_HERE_PALLADIO.md first
   - **Migration Projects**: Read README.md and MIGRATION_STRATEGY.md 
   - **Automation Projects**: Read relevant guides in /workspace/documentation/
   - **Analysis Projects**: Read SUMMARY.md for context
3. **Project-Specific Entry Points**:
   - Look for START_HERE_*.md files
   - Check docs/README.md for navigation
   - Review QUICK_REFERENCE_*.md files
4. **Focused Documentation Reading**: Based on task type, read only relevant documentation

### Phase 2: Selective Code Analysis (SCAN ONLY WHAT'S NEEDED)
- **For Palladio**: Focus on specific service/component directories, skip unrelated parts
- **For Migrations**: Analyze only transform_data.py, exports/, validation/ directories
- **For Automation**: Focus on relevant script directories and configuration files
- **Skip**: node_modules, build artifacts, unrelated codebases, database backups

## Rules & Constraints (CRITICAL - Follow Strictly)
- ‚ö†Ô∏è BACKUP before modifying any file (rename to .backup-TIMESTAMP)
- üìù Document changes as needed (not mandatory for minor updates)
- üö´ If breaking changes detected, create BREAKING_CHANGES.md and STOP
- ‚úÖ Run tests for critical functionality only
- üåø Always create feature branch: claude/session-${sessionId}
- üìã Create PR description with all changes listed
- üîÑ Commit frequently with meaningful messages

## Safety Protocol
- Create project backup before starting major changes
- Stop immediately if breaking changes are detected
- Document any blocking issues in ISSUES.md
- Never force-push or rewrite git history
- Verify all tests pass before declaring completion

## Communication Protocol
- Log progress every 30 minutes to logs/progress-$(date +%Y%m%d).log
- If stuck for >15 minutes, document the issue and continue
- Create summary report at completion in SUMMARY.md
- Document any external tool usage in logs/llm-interactions.log

## Tasks

### 1. Project Analysis
- **Description**: Analyze existing project structure and codebase
- **Requirements**: Understand current architecture, dependencies, and patterns
- **Acceptance Criteria**: Clear understanding of project layout and tech stack

### 2. Implementation
- **Description**: ${description}
- **Requirements**: 
  - Follow existing code patterns and structure
  - Ensure cross-browser compatibility
  - Write clean, maintainable code
  - Handle edge cases and errors
- **Acceptance Criteria**: Fully functional implementation meeting all requirements

### 3. Testing & Validation
- **Description**: Test the implementation thoroughly
- **Requirements**: 
  - Manual testing of all features
  - Edge case testing
  - Cross-browser testing (if web app)
  - Performance validation
- **Acceptance Criteria**: All features work correctly with no critical bugs

### 4. Documentation
- **Description**: Create comprehensive documentation
- **Requirements**:
  - Update README if needed
  - Add inline code comments
  - Document any new APIs or components
  - Include usage examples
- **Acceptance Criteria**: Clear documentation for future maintenance

## Working Instructions

### üö® CRITICAL FIRST STEP: UNDERSTAND THE TASK

**‚ö†Ô∏è DO NOT CREATE FILES FOR SIMPLE RESPONSES!**

Decision Flow:
\`\`\`
‚îå‚îÄ‚ñ∫ Is this a simple response task? (greeting, calculation, one-line answer)
‚îÇ   ‚îî‚îÄ‚ñ∫ YES ‚Üí Output the response directly. NO files, NO git, NO branches!
‚îÇ   ‚îî‚îÄ‚ñ∫ NO ‚Üí Continue to task classification below
\`\`\`

**Task Classification Guide:**
| Task Type | Detection Clues | Actions Allowed |
|-----------|----------------|-----------------|
| **Simple Response** | "respond with", "what is", "calculate" | Print answer only - NO files |
| **Analysis** | "explain", "audit", "review", "diagnose" | Read & report - NO modifications |
| **Implementation** | "create", "add", "implement", "build" | Full workflow - create files/code |
| **Fix/Update** | "fix", "update", "refactor", "change" | Modify specific files only |

### For Implementation Tasks:
1. üîç **Documentation-First Analysis**: Follow Phase 1 & 2 methodology above
2. üåø **Branch Creation**: Create feature branch claude/session-${sessionId}
3. üóÇÔ∏è **Project Organization**: For new projects, create dedicated folder structure
4. üíæ **Backup Phase**: Create backups of files before modification (as needed)
5. üõ†Ô∏è **Implementation**: Work systematically through each task
6. üß™ **Testing**: Write tests for critical functionality (not everything needs tests)
7. üìù **Documentation**: Update existing docs, create project-specific files
8. üîÑ **Git Workflow**: Commit frequently with clear messages
9. ‚úÖ **Validation**: Verify functionality works as expected
10. üìã **Summary**: Create project-appropriate completion documentation

## Navigation & Organization Rules
- **Start Here**: Always check \`/documentation/PROJECT_INDEX.md\` for complete project navigation
- **Configuration**: Reference \`/documentation/CONFIG.md\` for Git setup and working rules
- **Selective Reading**: Only read files relevant to the task, use README files for guidance
- **Organized Structure**: 
  - Main project: \`/palladio-software-25/\` (5 components: Backend, Frontend, CMS, CRM, API)
  - Automation: \`/automation/\` (Claude systems + utility scripts)
  - Analysis: \`/Spreadsheets-analysed/\` (business data tools)
  - Docs: \`/documentation/\` (guides, configs, navigation)
  - Archives: \`/Archives/\` (historical projects)

## File Structure Requirements
- logs/progress-$(date +%Y%m%d).log - Progress tracking
- PROGRESS.md - Task completion status  
- SUMMARY.md - Final completion report
- ISSUES.md - Any blocking problems encountered
- CHANGELOG.md - All changes documented
- BREAKING_CHANGES.md - If breaking changes detected

## Technical Requirements
- [ ] Write clean, well-structured code following existing patterns
- [ ] Follow existing project conventions and style
- [ ] Add appropriate error handling and validation
- [ ] Ensure responsive design (if UI components)
- [ ] Use RESTful conventions (if API development)
- [ ] Include request/response validation
- [ ] Create meaningful git commits with clear messages
- [ ] Test thoroughly before completion
- [ ] Document all changes and new features

## Git Configuration
- Username: abhishek-notes
- Email: abhisheksoni1551@gmail.com
- Branch: claude/session-${sessionId}
- Commit style: "feat/fix/docs: Clear description"
- GitHub Token: Available at /Users/abhishek/Work/config/.env.github (GitHub classic token)

## Technical Requirements
- [ ] Write clean, well-structured code
- [ ] Follow existing project conventions
- [ ] Add appropriate error handling
- [ ] Ensure responsive design (if UI components)
- [ ] Create meaningful git commits
- [ ] Test thoroughly before completion

## Deliverables
- [ ] Working implementation of: ${description}
- [ ] Updated documentation
- [ ] PROGRESS.md with step-by-step progress
- [ ] SUMMARY.md with final results and instructions
- [ ] Git commits with clear messages

## Success Criteria
The task is complete when:
1. ${description} is fully implemented and working
2. All edge cases are handled
3. Code is clean and well-documented
4. No critical bugs remain
5. SUMMARY.md confirms successful completion
6. No critical bugs remain
7. All changes are committed to GitHub repository (Git serves as backup)
8. CHANGELOG.md reflects all changes made
9. SUMMARY.md confirms successful completion with usage instructions

## Emergency Protocols
- If breaking changes detected: STOP, document in BREAKING_CHANGES.md
- If tests fail: Fix immediately before continuing
- If stuck >15 minutes: Document in ISSUES.md, try alternative approach
- If external dependencies needed: Document requirements clearly

## External Tool Access Guidelines
- Can use package managers (npm, pip, yarn) for dependencies
- Git operations for version control
- Testing frameworks as needed
- Documentation generators
- Code formatters and linters
- NO external network calls during development
- Document all tool usage in logs/llm-interactions.log

## Efficient File Reading Strategy
- **AVOID** scanning entire large codebases when working in /Users/abhishek/work
- **START** with \`/documentation/PROJECT_INDEX.md\` for navigation and component mapping
- **USE** README files in each component for understanding structure
- **READ** only files directly relevant to the specific task
- **FOCUS** on the specific component you're working on (Backend, Frontend, CMS, CRM, API)
- **REFERENCE** \`/documentation/CONFIG.md\` for working rules and guidelines
- **LEVERAGE** existing documentation rather than exploring all code files

Start by checking navigation files and understanding the specific task scope, then implement features systematically following these comprehensive guidelines.

**Remember: Safety first, quality always, document everything!**`
			}

			function editImprovedTask() {
				const improved = document.getElementById(
					"improvedTaskContent"
				).textContent
				document.getElementById("taskDescription").value = improved
				document.getElementById("improvedTaskSection").classList.add("hidden")
			}

			function downloadTaskFile() {
				const content = document.getElementById(
					"improvedTaskContent"
				).textContent
				const blob = new Blob([content], { type: "text/markdown" })
				const url = URL.createObjectURL(blob)
				const a = document.createElement("a")
				a.href = url
				a.download = "CLAUDE_TASKS.md"
				document.body.appendChild(a)
				a.click()
				document.body.removeChild(a)
				URL.revokeObjectURL(url)
			}

			async function launchAutomatedTask() {
				const projectPath = document.getElementById("projectPath").value.trim()
				const taskContent = document.getElementById(
					"improvedTaskContent"
				).textContent
				const itermProfile = document.getElementById("itermProfile").value
				const useDocker = document.getElementById("useDocker").checked
				const openInNewTab = document.getElementById("openInNewTab").checked

				if (!projectPath) {
					alert("Please enter a project path")
					return
				}

				if (!taskContent) {
					alert("Please improve the task first")
					return
				}

				// Show execution section
				document.getElementById("executionSection").classList.remove("hidden")
				document.getElementById("statusPanel").className =
					"status-panel status-running"
				document.getElementById("stopButton").classList.remove("hidden")

				// Generate session ID
				const sessionId = "session-" + Date.now()

				try {
					// Launch real task via API
					const response = await fetch("/api/launch-task", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							projectPath: projectPath,
							taskContent: taskContent,
							sessionId: sessionId,
							itermProfile: itermProfile,
							useDocker: useDocker,
							openInNewTab: openInNewTab,
						}),
					})

					const result = await response.json()

					if (result.success) {
						// Start monitoring the real session
						monitorRealSession(sessionId)
					} else {
						throw new Error(result.error || "Failed to launch task")
					}
				} catch (error) {
					console.error("Error launching task:", error)
					document.getElementById("statusPanel").className =
						"status-panel status-error"
					document.getElementById("statusTitle").textContent =
						"‚ùå Launch Failed"
					document.getElementById("statusMessage").textContent =
						"Error: " + error.message
					document.getElementById("stopButton").classList.add("hidden")
				}
			}

			// Monitor real session via API
			async function monitorRealSession(sessionId) {
				const logOutput = document.getElementById("logOutput")
				const statusTitle = document.getElementById("statusTitle")
				const statusMessage = document.getElementById("statusMessage")

				statusTitle.textContent = "üöÄ Executing Automated Task"
				statusMessage.textContent = `Running Claude automation...`

				currentSessionId = sessionId

				// Poll for session status and logs
				const pollInterval = setInterval(async () => {
					try {
						// Get session status
						const statusResponse = await fetch(
							`/api/session/${sessionId}/status`
						)
						const statusData = await statusResponse.json()

						// Get session logs
						const logsResponse = await fetch(`/api/session/${sessionId}/logs`)
						const logsData = await logsResponse.json()

						// Update UI based on status
						if (statusData.status === "completed") {
							clearInterval(pollInterval)
							document.getElementById("statusPanel").className =
								"status-panel status-success"
							statusTitle.textContent = "üéâ Task Completed Successfully!"
							statusMessage.textContent =
								"Claude has completed all tasks. Check the project directory for results."
							document.getElementById("stopButton").classList.add("hidden")

							// Load and display results
							loadSessionResults(sessionId)
						} else if (
							statusData.status === "failed" ||
							statusData.status === "error"
						) {
							clearInterval(pollInterval)
							document.getElementById("statusPanel").className =
								"status-panel status-error"
							statusTitle.textContent = "‚ùå Task Failed"
							statusMessage.textContent =
								"Task execution failed. Check logs for details."
							document.getElementById("stopButton").classList.add("hidden")
						} else if (statusData.status === "stopped") {
							clearInterval(pollInterval)
							document.getElementById("statusPanel").className =
								"status-panel status-error"
							statusTitle.textContent = "üõë Task Stopped"
							statusMessage.textContent = "Task execution was stopped."
							document.getElementById("stopButton").classList.add("hidden")
						}

						// Update logs
						if (logsData.logs && logsData.logs.length > 0) {
							logOutput.innerHTML = ""
							logsData.logs.forEach((log) => {
								const timestamp = new Date(log.timestamp).toLocaleTimeString()
								const logLine = `[${timestamp}] ${log.message}`
								logOutput.innerHTML += logLine + "\n"
							})
							logOutput.scrollTop = logOutput.scrollHeight
						}
					} catch (error) {
						console.error("Error monitoring session:", error)
						clearInterval(pollInterval)
						document.getElementById("statusPanel").className =
							"status-panel status-error"
						statusTitle.textContent = "‚ùå Monitoring Error"
						statusMessage.textContent = "Lost connection to task execution."
					}
				}, 2000) // Poll every 2 seconds

				executionProcess = pollInterval
			}

			// Load session results
			async function loadSessionResults(sessionId) {
				try {
					const response = await fetch(`/api/session/${sessionId}/results`)
					const results = await response.json()

					// Display results in a new section or update existing
					const logOutput = document.getElementById("logOutput")
					logOutput.innerHTML += "\n=== TASK RESULTS ===\n"

					if (results.files.SUMMARY) {
						logOutput.innerHTML +=
							"\nüìä SUMMARY:\n" + results.files.SUMMARY + "\n"
					}

					if (results.files.PROGRESS) {
						logOutput.innerHTML +=
							"\nüìù PROGRESS:\n" + results.files.PROGRESS + "\n"
					}

					if (results.files.ISSUES) {
						logOutput.innerHTML +=
							"\n‚ö†Ô∏è ISSUES:\n" + results.files.ISSUES + "\n"
					}

					logOutput.scrollTop = logOutput.scrollHeight
				} catch (error) {
					console.error("Error loading results:", error)
				}
			}

			async function stopExecution() {
				if (currentSessionId) {
					try {
						const response = await fetch(
							`/api/session/${currentSessionId}/stop`,
							{
								method: "POST",
								headers: {
									"Content-Type": "application/json",
								},
							}
						)

						const result = await response.json()
						console.log("Stop result:", result)
					} catch (error) {
						console.error("Error stopping session:", error)
					}
				}

				if (executionProcess) {
					clearInterval(executionProcess)
					executionProcess = null
				}

				document.getElementById("statusPanel").className =
					"status-panel status-error"
				document.getElementById("statusTitle").textContent =
					"üõë Execution Stopped"
				document.getElementById("statusMessage").textContent =
					"Task execution was stopped by user."
				document.getElementById("stopButton").classList.add("hidden")
			}

			function viewResults() {
				const projectPath = document.getElementById("projectPath").value.trim()
				alert(
					`Results should be available in: ${projectPath}\n\nCheck for:\n- PROGRESS.md\n- SUMMARY.md\n- New/modified code files\n- Git commits`
				)
			}

			function createNewTask() {
				document.getElementById("taskDescription").value = ""
				document.getElementById("projectPath").value = "/Users/abhishek/Work/"
				document.getElementById("improvedTaskSection").classList.add("hidden")
				document.getElementById("executionSection").classList.add("hidden")
				currentTask = ""
			}

			// Update iTerm profile suggestion based on project path
			function updateProfileSuggestion() {
				const projectPath = document
					.getElementById("projectPath")
					.value.toLowerCase()
				const profileSelect = document.getElementById("itermProfile")

				// Smart profile suggestions based on project path
				if (projectPath.includes("palladio")) {
					profileSelect.value = "Palladio"
				} else if (
					projectPath.includes("automation") ||
					projectPath.includes("claude")
				) {
					profileSelect.value = "Automation"
				} else if (
					projectPath.includes("work") ||
					projectPath.includes("api")
				) {
					profileSelect.value = "Work"
				} else {
					profileSelect.value = "Default"
				}
			}

			// Initialize
			document.addEventListener("DOMContentLoaded", function () {
				// Set default project path
				const defaultPath = "/Users/abhishek/Work/"
				document.getElementById("projectPath").value = defaultPath

				// Set initial profile suggestion
				updateProfileSuggestion()
			})
		</script>
	</body>
</html>
